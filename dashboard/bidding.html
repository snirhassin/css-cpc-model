<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bidding &amp; Products | Royal Deals Seller Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="shared.css">
    <style>
        /* ================================================================
           BIDDING PAGE - Scoped Styles
           ================================================================ */

        /* Category Overview Cards */
        .category-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .category-card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
            transition: box-shadow 0.3s, transform 0.3s;
        }

        .category-card:hover {
            box-shadow: var(--shadow);
            transform: translateY(-2px);
        }

        .category-card-name {
            font-size: 18px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 16px;
        }

        .category-card-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .category-stat {
            text-align: center;
        }

        .category-stat-value {
            font-size: 20px;
            font-weight: 800;
            color: var(--primary);
            line-height: 1.2;
        }

        .category-stat-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-top: 4px;
        }

        /* Controls Bar */
        .controls-bar {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .filter-pills {
            display: flex;
            gap: 4px;
            background: var(--bg);
            border-radius: 10px;
            padding: 4px;
            border: 1px solid var(--border);
        }

        .filter-pill {
            padding: 8px 18px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-light);
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .filter-pill:hover {
            color: var(--text);
        }

        .filter-pill.active {
            background: var(--white);
            color: var(--dark);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }

        .sort-dropdown {
            padding: 8px 36px 8px 14px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 8px;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' fill='%2364748b'%3E%3Cpath d='M1 1l5 5 5-5'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            cursor: pointer;
            outline: none;
            transition: border-color 0.2s;
        }

        .sort-dropdown:focus {
            border-color: var(--primary);
        }

        .controls-spacer {
            flex: 1;
        }

        /* Product Table Specifics */
        .product-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
            max-width: 260px;
        }

        .product-title {
            font-weight: 600;
            color: var(--dark);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 14px;
            line-height: 1.4;
        }

        .product-asin {
            font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
            font-size: 12px;
            color: var(--text-light);
        }

        .bid-display {
            font-weight: 700;
            color: var(--primary);
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 6px;
            transition: background 0.2s;
            white-space: nowrap;
        }

        .bid-display:hover {
            background: rgba(26, 60, 110, 0.06);
        }

        .bid-edit-input {
            width: 80px;
            padding: 4px 8px;
            font-size: 14px;
            font-weight: 700;
            color: var(--primary);
            border: 2px solid var(--primary);
            border-radius: 6px;
            outline: none;
            background: var(--white);
            font-family: inherit;
        }

        .cpc-text {
            color: var(--text-light);
            font-size: 14px;
        }

        /* Position Badge */
        .position-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 700;
        }

        .position-badge--gold {
            background: rgba(232, 168, 56, 0.15);
            color: #b8860b;
        }

        .position-badge--blue {
            background: rgba(26, 60, 110, 0.1);
            color: var(--primary);
        }

        .position-badge--gray {
            background: var(--bg);
            color: var(--text-light);
        }

        /* Impression Share Mini Bar */
        .imp-share-cell {
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 110px;
        }

        .imp-share-bar {
            flex: 1;
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
            min-width: 40px;
        }

        .imp-share-fill {
            height: 100%;
            border-radius: 3px;
            background: var(--accent);
            transition: width 0.4s ease;
        }

        .imp-share-text {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            white-space: nowrap;
            min-width: 36px;
        }

        /* Quality Score */
        .qs-cell {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .qs-value {
            font-size: 14px;
            font-weight: 700;
        }

        .qs-value--green { color: var(--success); }
        .qs-value--yellow { color: var(--warning); }
        .qs-value--red { color: var(--danger); }

        .qs-info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--bg);
            border: 1px solid var(--border);
            font-size: 10px;
            font-weight: 700;
            color: var(--text-light);
            cursor: help;
            position: relative;
        }

        .qs-tooltip {
            display: none;
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: var(--white);
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            z-index: 50;
            box-shadow: var(--shadow-lg);
            line-height: 1.6;
        }

        .qs-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: var(--dark);
        }

        .qs-info-icon:hover .qs-tooltip {
            display: block;
        }

        /* ROAS coloring */
        .roas-value { font-weight: 700; font-size: 14px; }
        .roas-value--green { color: var(--success); }
        .roas-value--yellow { color: var(--warning); }
        .roas-value--red { color: var(--danger); }

        /* Bid Simulator Panel */
        .simulator-panel {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            transition: box-shadow 0.3s;
        }

        .simulator-panel:hover {
            box-shadow: var(--shadow);
        }

        .simulator-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            cursor: pointer;
            user-select: none;
            transition: background 0.2s;
        }

        .simulator-header:hover {
            background: var(--bg);
        }

        .simulator-header h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .simulator-header h3 .sim-icon {
            width: 32px;
            height: 32px;
            background: rgba(26, 60, 110, 0.08);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .collapse-toggle {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: var(--text-light);
            transition: transform 0.3s, background 0.2s;
        }

        .collapse-toggle.open {
            transform: rotate(180deg);
        }

        .simulator-body {
            padding: 0 24px 24px;
            display: none;
        }

        .simulator-body.open {
            display: block;
        }

        .simulator-controls {
            display: flex;
            gap: 20px;
            margin-bottom: 24px;
            align-items: flex-end;
        }

        .simulator-controls .form-group {
            margin-bottom: 0;
        }

        .simulator-controls .form-group:first-child {
            flex: 1;
            max-width: 300px;
        }

        .simulator-slider-group {
            flex: 2;
        }

        .sim-results-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }

        .sim-result-box {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            transition: border-color 0.3s;
        }

        .sim-result-box--highlight {
            background: rgba(16, 185, 129, 0.04);
            border-color: rgba(16, 185, 129, 0.25);
        }

        .sim-result-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-light);
            margin-bottom: 8px;
        }

        .sim-result-value {
            font-size: 24px;
            font-weight: 800;
            color: var(--dark);
            line-height: 1.2;
        }

        .sim-result-value .arrow {
            color: var(--accent);
            font-size: 18px;
            margin: 0 6px;
        }

        .sim-result-sub {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 4px;
        }

        /* Competitive Insights Panel */
        .insights-panel {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
        }

        .insights-panel h3 {
            font-size: 16px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 20px;
        }

        .insights-category-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            background: rgba(26, 60, 110, 0.06);
            color: var(--primary);
            margin-bottom: 20px;
        }

        .insight-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .insight-row:last-child {
            border-bottom: none;
        }

        .insight-label {
            font-size: 14px;
            color: var(--text-light);
            font-weight: 500;
        }

        .insight-value {
            font-size: 14px;
            font-weight: 700;
            color: var(--dark);
        }

        .bid-comparison {
            margin: 16px 0;
        }

        .bid-comparison-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .bid-comparison-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-light);
            width: 100px;
            flex-shrink: 0;
        }

        .bid-comparison-bar-bg {
            flex: 1;
            height: 10px;
            background: var(--border);
            border-radius: 5px;
            overflow: hidden;
        }

        .bid-comparison-bar-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.6s ease;
        }

        .bid-comparison-bar-fill--yours {
            background: var(--primary);
        }

        .bid-comparison-bar-fill--avg {
            background: var(--text-light);
        }

        .bid-comparison-value {
            font-size: 13px;
            font-weight: 700;
            color: var(--text);
            min-width: 45px;
            text-align: right;
        }

        .suggested-bid-box {
            background: rgba(232, 168, 56, 0.08);
            border: 1px solid rgba(232, 168, 56, 0.2);
            border-radius: var(--radius);
            padding: 16px;
            margin-top: 16px;
            text-align: center;
        }

        .suggested-bid-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: 6px;
        }

        .suggested-bid-value {
            font-size: 22px;
            font-weight: 800;
            color: var(--accent-hover, #d4952e);
        }

        /* Bottom grid for simulator and insights */
        .bottom-panels {
            display: grid;
            grid-template-columns: 1fr 340px;
            gap: 20px;
        }

        /* Responsive: hide cols on mobile */
        @media (max-width: 1024px) {
            .category-card-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
            }

            .sim-results-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .bottom-panels {
                grid-template-columns: 1fr;
            }

            .simulator-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .simulator-controls .form-group:first-child {
                max-width: 100%;
            }
        }

        @media (max-width: 768px) {
            .category-cards {
                grid-template-columns: 1fr;
            }

            .controls-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .controls-spacer {
                display: none;
            }

            /* Hide Imp. Share and Quality Score columns on mobile */
            .col-imp-share,
            .col-quality-score {
                display: none;
            }

            .sim-results-grid {
                grid-template-columns: 1fr;
            }

            .simulator-controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>

<!-- ================================================================
     NAVIGATION
     ================================================================ -->
<nav class="dash-nav">
    <div class="container">
        <a href="../index.html" class="dash-nav-logo">
            <div class="dash-nav-logo-icon">R</div>
            <div class="dash-nav-logo-text">Royal<span>Deals</span></div>
        </a>

        <ul class="dash-nav-tabs" id="navTabs">
            <li><a href="dashboard.html">Overview</a></li>
            <li><a href="bidding.html" class="active">Bidding &amp; Products</a></li>
            <li><a href="reports.html">Reports</a></li>
            <li><a href="billing.html">Billing</a></li>
            <li><a href="settings.html">Settings</a></li>
        </ul>

        <div class="dash-nav-right">
            <div class="dash-nav-balance">
                <span class="dash-nav-balance-label">Balance:</span>
                $<span id="navBalance">287.43</span>
            </div>
            <div class="dash-nav-avatar" title="TechGear Direct">T</div>
        </div>

        <button class="dash-nav-hamburger" id="hamburgerBtn" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </div>
</nav>

<!-- ================================================================
     PAGE CONTENT
     ================================================================ -->
<main class="page-content section-gap">

    <!-- Page Header -->
    <div class="page-header">
        <div class="page-header-text">
            <h1>Bidding &amp; Products</h1>
            <p>Manage your product bids, monitor positions, and optimise performance across categories.</p>
        </div>
        <div class="page-header-actions">
            <button class="btn-primary btn-sm" id="addProductBtn">+ Add Product</button>
        </div>
    </div>

    <!-- Section 1: Category Overview Cards -->
    <section class="category-cards" id="categoryCards">
        <!-- Rendered by JS -->
    </section>

    <!-- Section 2: Controls Bar -->
    <section class="controls-bar">
        <div class="filter-pills" id="filterPills">
            <button class="filter-pill active" data-filter="all">All</button>
            <button class="filter-pill" data-filter="active">Active</button>
            <button class="filter-pill" data-filter="paused">Paused</button>
        </div>

        <select class="sort-dropdown" id="sortDropdown">
            <option value="position">Sort: Position</option>
            <option value="bid">Sort: Bid</option>
            <option value="roas">Sort: ROAS</option>
            <option value="qualityScore">Sort: Quality Score</option>
        </select>

        <div class="controls-spacer"></div>
    </section>

    <!-- Section 3: Product Bid Table -->
    <section>
        <div class="data-table-wrapper">
            <table class="data-table" id="productTable">
                <thead>
                    <tr>
                        <th class="sortable" data-sort="title">Product <span class="sort-indicator">&#x25B2;&#x25BC;</span></th>
                        <th>Category</th>
                        <th class="sortable" data-sort="bid">Your Bid <span class="sort-indicator">&#x25B2;&#x25BC;</span></th>
                        <th>Est. CPC</th>
                        <th class="sortable" data-sort="position">Position <span class="sort-indicator">&#x25B2;&#x25BC;</span></th>
                        <th class="col-imp-share">Imp. Share</th>
                        <th class="col-quality-score sortable" data-sort="qualityScore">Quality Score <span class="sort-indicator">&#x25B2;&#x25BC;</span></th>
                        <th>Clicks (30d)</th>
                        <th class="sortable" data-sort="roas">ROAS <span class="sort-indicator">&#x25B2;&#x25BC;</span></th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="productTableBody">
                    <!-- Rendered by JS -->
                </tbody>
            </table>
        </div>
    </section>

    <!-- Section 4: Bid Simulator + Competitive Insights -->
    <section class="bottom-panels">

        <!-- Bid Simulator Panel -->
        <div class="simulator-panel">
            <div class="simulator-header" id="simToggle">
                <h3>
                    <span class="sim-icon">&#x2696;</span>
                    Bid Simulator
                </h3>
                <div class="collapse-toggle open" id="collapseIcon">&#x25BC;</div>
            </div>
            <div class="simulator-body open" id="simBody">
                <div class="simulator-controls">
                    <div class="form-group">
                        <label class="form-label">Select Product</label>
                        <select class="form-select" id="simProductSelect">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div class="form-group simulator-slider-group">
                        <div class="bid-slider-label">
                            <span>Simulated Bid</span>
                            <strong>$<span id="simSliderValue">0.35</span></strong>
                        </div>
                        <input type="range" class="bid-slider" id="simSlider" min="0.08" max="1.00" step="0.01" value="0.35">
                    </div>
                </div>

                <div class="sim-results-grid">
                    <div class="sim-result-box">
                        <div class="sim-result-label">Position</div>
                        <div class="sim-result-value">
                            <span id="simOldPosition">2</span>
                            <span class="arrow">&#x2192;</span>
                            <span id="simNewPosition">1</span>
                        </div>
                        <div class="sim-result-sub">Estimated rank change</div>
                    </div>
                    <div class="sim-result-box">
                        <div class="sim-result-label">Est. CPC</div>
                        <div class="sim-result-value">
                            <span id="simOldCpc">$0.28</span>
                            <span class="arrow">&#x2192;</span>
                            <span id="simNewCpc">$0.35</span>
                        </div>
                        <div class="sim-result-sub">Cost per click</div>
                    </div>
                    <div class="sim-result-box sim-result-box--highlight">
                        <div class="sim-result-label">Est. Daily Clicks</div>
                        <div class="sim-result-value" id="simDailyClicks">18</div>
                        <div class="sim-result-sub">Based on new position</div>
                    </div>
                    <div class="sim-result-box sim-result-box--highlight">
                        <div class="sim-result-label">Est. Daily Spend</div>
                        <div class="sim-result-value" id="simDailySpend">$6.30</div>
                        <div class="sim-result-sub">Projected budget impact</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Competitive Insights Panel -->
        <div class="insights-panel" id="insightsPanel">
            <h3>Competitive Insights</h3>
            <div class="insights-category-badge" id="insightsCategoryBadge">Electronics</div>

            <div class="insight-row">
                <span class="insight-label">Bid Range</span>
                <span class="insight-value" id="insightsBidRange">$0.15 - $0.55</span>
            </div>
            <div class="insight-row">
                <span class="insight-label">Avg. CPC</span>
                <span class="insight-value" id="insightsAvgCpc">$0.42</span>
            </div>
            <div class="insight-row">
                <span class="insight-label">Total Advertisers</span>
                <span class="insight-value" id="insightsTotalAdv">8</span>
            </div>

            <div class="bid-comparison" id="bidComparison">
                <div class="bid-comparison-row">
                    <span class="bid-comparison-label">Your Avg Bid</span>
                    <div class="bid-comparison-bar-bg">
                        <div class="bid-comparison-bar-fill bid-comparison-bar-fill--yours" id="yourBidBar" style="width: 60%;"></div>
                    </div>
                    <span class="bid-comparison-value" id="yourBidValue">$0.30</span>
                </div>
                <div class="bid-comparison-row">
                    <span class="bid-comparison-label">Category Avg</span>
                    <div class="bid-comparison-bar-bg">
                        <div class="bid-comparison-bar-fill bid-comparison-bar-fill--avg" id="catBidBar" style="width: 50%;"></div>
                    </div>
                    <span class="bid-comparison-value" id="catBidValue">$0.30</span>
                </div>
            </div>

            <div class="suggested-bid-box">
                <div class="suggested-bid-label">Suggested bid for Position #1</div>
                <div class="suggested-bid-value" id="suggestedBidValue">$0.48</div>
            </div>
        </div>
    </section>

</main>

<!-- ================================================================
     FOOTER
     ================================================================ -->
<footer class="dash-footer">
    <div class="container">
        <div class="dash-footer-left">
            <div class="dash-footer-logo-icon">R</div>
            <div class="dash-footer-text">Royal<span>Deals</span> Seller Dashboard</div>
        </div>
        <div class="dash-footer-copyright">&copy; 2026 Royal Deals. All rights reserved.</div>
        <div class="dash-footer-links">
            <a href="#">Terms</a>
            <a href="#">Privacy</a>
            <a href="#">Support</a>
        </div>
    </div>
</footer>

<!-- ================================================================
     SCRIPTS
     ================================================================ -->
<script src="mock-data.js"></script>
<script src="auction-engine.js"></script>
<script>
(function () {
    'use strict';

    // ----------------------------------------------------------------
    //  State
    // ----------------------------------------------------------------
    let products = JSON.parse(JSON.stringify(DEMO_PRODUCTS)); // deep copy
    let currentFilter = 'all';
    let currentSort = 'position';
    let sortDirection = 'asc';
    let engine = new AuctionEngine(MOCK_COMPETITORS, BID_FLOORS);

    // ----------------------------------------------------------------
    //  Helpers
    // ----------------------------------------------------------------
    function formatCurrency(n) {
        return '$' + n.toFixed(2);
    }

    function getCategoryLabel(cat) {
        const labels = {
            electronics: 'Electronics',
            home_office: 'Home & Office',
            kitchen: 'Kitchen',
            health_beauty: 'Health & Beauty',
            sports_outdoors: 'Sports & Outdoors'
        };
        return labels[cat] || cat;
    }

    function getQsColor(score) {
        if (score >= 7) return 'green';
        if (score >= 5) return 'yellow';
        return 'red';
    }

    function getRoasColor(roas) {
        if (roas >= 5) return 'green';
        if (roas >= 2) return 'yellow';
        return 'red';
    }

    function getPositionBadgeClass(pos) {
        if (pos === 1) return 'position-badge--gold';
        if (pos === 2) return 'position-badge--blue';
        return 'position-badge--gray';
    }

    // ----------------------------------------------------------------
    //  Render: Category Overview Cards
    // ----------------------------------------------------------------
    function renderCategoryCards() {
        const container = document.getElementById('categoryCards');
        const categories = {};

        products.forEach(function (p) {
            if (!categories[p.category]) {
                categories[p.category] = { count: 0, bidFloor: BID_FLOORS[p.category] || 0.05 };
            }
            categories[p.category].count++;
        });

        // Hard-coded card data matching the spec
        const cardData = [
            {
                name: 'Electronics',
                id: 'electronics',
                products: products.filter(function (p) { return p.category === 'electronics'; }).length,
                bidFloor: formatCurrency(BID_FLOORS.electronics || 0.08),
                avgCpc: '$0.42',
                advertisers: (MOCK_COMPETITORS.electronics || []).length + 1 // +1 for seller
            },
            {
                name: 'Home & Office',
                id: 'home_office',
                products: products.filter(function (p) { return p.category === 'home_office'; }).length,
                bidFloor: formatCurrency(BID_FLOORS.home_office || 0.06),
                avgCpc: '$0.28',
                advertisers: (MOCK_COMPETITORS.home_office || []).length + 1
            }
        ];

        container.innerHTML = cardData.map(function (cat) {
            return '<div class="category-card">' +
                '<div class="category-card-name">' + cat.name + '</div>' +
                '<div class="category-card-stats">' +
                    '<div class="category-stat">' +
                        '<div class="category-stat-value">' + cat.products + '</div>' +
                        '<div class="category-stat-label">Products</div>' +
                    '</div>' +
                    '<div class="category-stat">' +
                        '<div class="category-stat-value">' + cat.bidFloor + '</div>' +
                        '<div class="category-stat-label">Bid Floor</div>' +
                    '</div>' +
                    '<div class="category-stat">' +
                        '<div class="category-stat-value">' + cat.avgCpc + '</div>' +
                        '<div class="category-stat-label">Avg CPC</div>' +
                    '</div>' +
                    '<div class="category-stat">' +
                        '<div class="category-stat-value">' + cat.advertisers + '</div>' +
                        '<div class="category-stat-label">Advertisers</div>' +
                    '</div>' +
                '</div>' +
            '</div>';
        }).join('');
    }

    // ----------------------------------------------------------------
    //  Render: Product Table
    // ----------------------------------------------------------------
    function getFilteredSortedProducts() {
        var filtered = products;
        if (currentFilter !== 'all') {
            filtered = products.filter(function (p) { return p.status === currentFilter; });
        }

        filtered = filtered.slice(); // shallow copy for sorting

        filtered.sort(function (a, b) {
            var valA, valB;
            switch (currentSort) {
                case 'title':
                    return sortDirection === 'asc'
                        ? a.title.localeCompare(b.title)
                        : b.title.localeCompare(a.title);
                case 'bid':
                    valA = a.maxCpcBid; valB = b.maxCpcBid;
                    break;
                case 'position':
                    valA = a.estimatedPosition; valB = b.estimatedPosition;
                    break;
                case 'roas':
                    valA = a.roas; valB = b.roas;
                    break;
                case 'qualityScore':
                    valA = a.qualityScore; valB = b.qualityScore;
                    break;
                default:
                    valA = a.estimatedPosition; valB = b.estimatedPosition;
            }
            if (typeof valA === 'number') {
                return sortDirection === 'asc' ? valA - valB : valB - valA;
            }
            return 0;
        });

        return filtered;
    }

    function renderTable() {
        var tbody = document.getElementById('productTableBody');
        var list = getFilteredSortedProducts();

        if (list.length === 0) {
            tbody.innerHTML = '<tr><td colspan="10" style="text-align:center;padding:40px;color:var(--text-light);">No products match the current filter.</td></tr>';
            return;
        }

        tbody.innerHTML = list.map(function (p) {
            var qsDisplay = (p.qualityScore * 10).toFixed(1);
            var qsColor = getQsColor(p.qualityScore * 10);
            var roasColor = getRoasColor(p.roas);
            var posBadge = getPositionBadgeClass(p.estimatedPosition);
            var impPct = Math.round(p.impressionShare * 100);

            var qb = p.qualityBreakdown;
            var tooltipHtml = 'Relevance: ' + (qb.relevance * 10).toFixed(1) + '/10<br>' +
                'CTR: ' + (qb.ctr * 10).toFixed(1) + '/10<br>' +
                'Data Quality: ' + (qb.dataQuality * 10).toFixed(1) + '/10<br>' +
                'Standing: ' + (qb.standing * 10).toFixed(1) + '/10';

            return '<tr data-id="' + p.id + '">' +
                '<td>' +
                    '<div class="product-info">' +
                        '<span class="product-title" title="' + p.title + '">' + p.title + '</span>' +
                        '<span class="product-asin">' + p.asin + '</span>' +
                    '</div>' +
                '</td>' +
                '<td><span class="badge badge--primary">' + getCategoryLabel(p.category) + '</span></td>' +
                '<td>' +
                    '<span class="bid-display" data-product-id="' + p.id + '" title="Click to edit">' + formatCurrency(p.maxCpcBid) + '</span>' +
                '</td>' +
                '<td><span class="cpc-text">' + formatCurrency(p.currentEstimatedCpc) + '</span></td>' +
                '<td><span class="position-badge ' + posBadge + '">#' + p.estimatedPosition + '</span></td>' +
                '<td class="col-imp-share">' +
                    '<div class="imp-share-cell">' +
                        '<div class="imp-share-bar"><div class="imp-share-fill" style="width:' + impPct + '%;"></div></div>' +
                        '<span class="imp-share-text">' + impPct + '%</span>' +
                    '</div>' +
                '</td>' +
                '<td class="col-quality-score">' +
                    '<div class="qs-cell">' +
                        '<span class="qs-value qs-value--' + qsColor + '">' + qsDisplay + '/10</span>' +
                        '<span class="qs-info-icon">i<div class="qs-tooltip">' + tooltipHtml + '</div></span>' +
                    '</div>' +
                '</td>' +
                '<td>' + p.clicks.toLocaleString() + '</td>' +
                '<td><span class="roas-value roas-value--' + roasColor + '">' + p.roas.toFixed(2) + 'x</span></td>' +
                '<td>' +
                    '<label class="toggle-switch">' +
                        '<input type="checkbox" ' + (p.status === 'active' ? 'checked' : '') + ' data-toggle-id="' + p.id + '">' +
                        '<span class="toggle-slider"></span>' +
                    '</label>' +
                '</td>' +
            '</tr>';
        }).join('');

        // Attach event listeners
        attachBidEditListeners();
        attachToggleListeners();
    }

    // ----------------------------------------------------------------
    //  Inline Bid Editing
    // ----------------------------------------------------------------
    function attachBidEditListeners() {
        var bidCells = document.querySelectorAll('.bid-display');
        bidCells.forEach(function (cell) {
            cell.addEventListener('click', function () {
                var productId = this.getAttribute('data-product-id');
                var product = products.find(function (p) { return p.id === productId; });
                if (!product) return;

                var currentVal = product.maxCpcBid;
                var td = this.parentElement;

                td.innerHTML = '<input type="text" class="bid-edit-input" value="' + currentVal.toFixed(2) + '" data-product-id="' + productId + '">';
                var input = td.querySelector('.bid-edit-input');
                input.focus();
                input.select();

                function saveBid() {
                    var newVal = parseFloat(input.value);
                    var floor = BID_FLOORS[product.category] || 0.05;

                    if (isNaN(newVal) || newVal < floor) {
                        newVal = currentVal; // revert
                    }

                    product.maxCpcBid = Math.round(newVal * 100) / 100;

                    // Re-run auction to get new position and CPC
                    var result = engine.runAuction(product.category, product.maxCpcBid, product.qualityScore);
                    product.estimatedPosition = result.position;
                    product.currentEstimatedCpc = result.estimatedCpc;
                    product.impressionShare = result.impressionShare;

                    renderTable();
                    renderCategoryCards();
                    updateInsightsPanel();
                }

                input.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter') {
                        saveBid();
                    } else if (e.key === 'Escape') {
                        renderTable();
                    }
                });

                input.addEventListener('blur', saveBid);
            });
        });
    }

    // ----------------------------------------------------------------
    //  Status Toggle
    // ----------------------------------------------------------------
    function attachToggleListeners() {
        var toggles = document.querySelectorAll('[data-toggle-id]');
        toggles.forEach(function (toggle) {
            toggle.addEventListener('change', function () {
                var productId = this.getAttribute('data-toggle-id');
                var product = products.find(function (p) { return p.id === productId; });
                if (product) {
                    product.status = this.checked ? 'active' : 'paused';
                    renderTable();
                    renderCategoryCards();
                }
            });
        });
    }

    // ----------------------------------------------------------------
    //  Filter Pills
    // ----------------------------------------------------------------
    function initFilterPills() {
        var pills = document.querySelectorAll('.filter-pill');
        pills.forEach(function (pill) {
            pill.addEventListener('click', function () {
                pills.forEach(function (p) { p.classList.remove('active'); });
                this.classList.add('active');
                currentFilter = this.getAttribute('data-filter');
                renderTable();
            });
        });
    }

    // ----------------------------------------------------------------
    //  Sort Dropdown
    // ----------------------------------------------------------------
    function initSortDropdown() {
        var dropdown = document.getElementById('sortDropdown');
        dropdown.addEventListener('change', function () {
            currentSort = this.value;
            renderTable();
        });
    }

    // ----------------------------------------------------------------
    //  Sortable Column Headers
    // ----------------------------------------------------------------
    function initColumnSort() {
        var headers = document.querySelectorAll('.data-table thead th.sortable');
        headers.forEach(function (th) {
            th.addEventListener('click', function () {
                var sortKey = this.getAttribute('data-sort');

                // Toggle direction if same column
                if (currentSort === sortKey) {
                    sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSort = sortKey;
                    sortDirection = 'asc';
                }

                // Update dropdown to match
                var dropdown = document.getElementById('sortDropdown');
                if (dropdown.querySelector('option[value="' + sortKey + '"]')) {
                    dropdown.value = sortKey;
                }

                // Update header styling
                headers.forEach(function (h) {
                    h.classList.remove('sort-asc', 'sort-desc');
                });
                this.classList.add(sortDirection === 'asc' ? 'sort-asc' : 'sort-desc');

                renderTable();
            });
        });
    }

    // ----------------------------------------------------------------
    //  Bid Simulator
    // ----------------------------------------------------------------
    function initSimulator() {
        var toggle = document.getElementById('simToggle');
        var body = document.getElementById('simBody');
        var icon = document.getElementById('collapseIcon');

        toggle.addEventListener('click', function () {
            body.classList.toggle('open');
            icon.classList.toggle('open');
        });

        // Populate product dropdown
        var select = document.getElementById('simProductSelect');
        products.forEach(function (p) {
            var option = document.createElement('option');
            option.value = p.id;
            option.textContent = p.title.length > 45 ? p.title.substring(0, 45) + '...' : p.title;
            select.appendChild(option);
        });

        var slider = document.getElementById('simSlider');
        var sliderValue = document.getElementById('simSliderValue');

        // Set initial slider to first product's bid
        if (products.length > 0) {
            var firstProduct = products[0];
            var floor = BID_FLOORS[firstProduct.category] || 0.05;
            slider.min = floor.toFixed(2);
            slider.value = firstProduct.maxCpcBid.toFixed(2);
            sliderValue.textContent = firstProduct.maxCpcBid.toFixed(2);
        }

        function updateSimulation() {
            var productId = select.value;
            var product = products.find(function (p) { return p.id === productId; });
            if (!product) return;

            var newBid = parseFloat(slider.value);
            sliderValue.textContent = newBid.toFixed(2);

            // Use AuctionEngine if available
            if (typeof AuctionEngine !== 'undefined' && engine) {
                var dailyImp = Math.round(product.impressions / 30);
                var simResult = engine.simulateBidChange(
                    product.category,
                    product.maxCpcBid,
                    newBid,
                    product.qualityScore,
                    dailyImp
                );

                document.getElementById('simOldPosition').textContent = '#' + simResult.oldPosition;
                document.getElementById('simNewPosition').textContent = '#' + simResult.newPosition;
                document.getElementById('simOldCpc').textContent = formatCurrency(simResult.oldCpc);
                document.getElementById('simNewCpc').textContent = formatCurrency(simResult.newCpc);
                document.getElementById('simDailyClicks').textContent = simResult.estimatedDailyClicks;
                document.getElementById('simDailySpend').textContent = formatCurrency(simResult.estimatedDailySpend);
            } else {
                // Fallback mock calculations
                var bidRatio = newBid / product.maxCpcBid;
                var newPos = Math.max(1, Math.round(product.estimatedPosition / bidRatio));
                var newCpc = Math.min(newBid, product.currentEstimatedCpc * bidRatio);
                var estClicks = Math.round((product.clicks / 30) * bidRatio);
                var estSpend = Math.round(estClicks * newCpc * 100) / 100;

                document.getElementById('simOldPosition').textContent = '#' + product.estimatedPosition;
                document.getElementById('simNewPosition').textContent = '#' + newPos;
                document.getElementById('simOldCpc').textContent = formatCurrency(product.currentEstimatedCpc);
                document.getElementById('simNewCpc').textContent = formatCurrency(Math.round(newCpc * 100) / 100);
                document.getElementById('simDailyClicks').textContent = estClicks;
                document.getElementById('simDailySpend').textContent = formatCurrency(estSpend);
            }
        }

        slider.addEventListener('input', updateSimulation);

        select.addEventListener('change', function () {
            var product = products.find(function (p) { return p.id === select.value; });
            if (product) {
                var floor = BID_FLOORS[product.category] || 0.05;
                slider.min = floor.toFixed(2);
                slider.value = product.maxCpcBid.toFixed(2);
                sliderValue.textContent = product.maxCpcBid.toFixed(2);
                updateSimulation();
            }
        });

        // Run initial simulation
        updateSimulation();
    }

    // ----------------------------------------------------------------
    //  Competitive Insights Panel
    // ----------------------------------------------------------------
    function updateInsightsPanel() {
        // Default to electronics
        var categoryId = 'electronics';

        var insights;
        if (typeof AuctionEngine !== 'undefined' && engine) {
            insights = engine.getCompetitiveInsights(categoryId);
        } else {
            insights = {
                avgCpc: 0.30,
                bidRange: { min: 0.15, max: 0.55 },
                totalAdvertisers: 8,
                topBidEstimate: 0.48
            };
        }

        document.getElementById('insightsCategoryBadge').textContent = getCategoryLabel(categoryId);
        document.getElementById('insightsBidRange').textContent =
            formatCurrency(insights.bidRange.min) + ' - ' + formatCurrency(insights.bidRange.max);
        document.getElementById('insightsAvgCpc').textContent = formatCurrency(insights.avgCpc);
        document.getElementById('insightsTotalAdv').textContent = insights.totalAdvertisers + 1; // +1 for seller

        // Calculate seller's average bid in this category
        var catProducts = products.filter(function (p) { return p.category === categoryId; });
        var yourAvgBid = catProducts.length > 0
            ? catProducts.reduce(function (s, p) { return s + p.maxCpcBid; }, 0) / catProducts.length
            : 0;

        var maxBidForBar = Math.max(yourAvgBid, insights.avgCpc, insights.bidRange.max);

        document.getElementById('yourBidValue').textContent = formatCurrency(yourAvgBid);
        document.getElementById('catBidValue').textContent = formatCurrency(insights.avgCpc);

        document.getElementById('yourBidBar').style.width = Math.round((yourAvgBid / maxBidForBar) * 100) + '%';
        document.getElementById('catBidBar').style.width = Math.round((insights.avgCpc / maxBidForBar) * 100) + '%';

        // Suggested bid for position #1
        var suggestedBid;
        if (typeof AuctionEngine !== 'undefined' && engine) {
            var avgQs = catProducts.length > 0
                ? catProducts.reduce(function (s, p) { return s + p.qualityScore; }, 0) / catProducts.length
                : 0.80;
            suggestedBid = engine.getSuggestedBid(categoryId, 1, avgQs);
        } else {
            suggestedBid = 0.48;
        }
        document.getElementById('suggestedBidValue').textContent = formatCurrency(suggestedBid);
    }

    // ----------------------------------------------------------------
    //  Hamburger Menu
    // ----------------------------------------------------------------
    function initHamburger() {
        var btn = document.getElementById('hamburgerBtn');
        var tabs = document.getElementById('navTabs');
        btn.addEventListener('click', function () {
            tabs.classList.toggle('open');
        });
    }

    // ----------------------------------------------------------------
    //  Add Product Button (placeholder)
    // ----------------------------------------------------------------
    function initAddProduct() {
        var btn = document.getElementById('addProductBtn');
        btn.addEventListener('click', function () {
            alert('Add Product flow coming soon. This is a POC demo.');
        });
    }

    // ----------------------------------------------------------------
    //  Init
    // ----------------------------------------------------------------
    document.addEventListener('DOMContentLoaded', function () {
        renderCategoryCards();
        renderTable();
        initFilterPills();
        initSortDropdown();
        initColumnSort();
        initSimulator();
        updateInsightsPanel();
        initHamburger();
        initAddProduct();
    });

})();
</script>

</body>
</html>
